<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<title>Type Evaluation Example</title>
<link rel="stylesheet" type="text/css" href="PLUGINS_ROOT/PRODUCT_PLUGIN/book.css">
</head>


<body>
<h1>Example - Using the Type Evaluator</h1>
<p class="Code">// 'project' refers to a GroovyProject instance.<br>

<br>

// Get the various components to required for the type evaluation context.<br>

def contexts = createContexts(moduleNode, buffer, offset)<br>
def lookup = MemberLookupRegistry.createMemberLookup(contexts)<br>
def table = SymbolTableRegistry.createSymbolTable(contexts)<br>

// Optional - set the project, necessary if this is a project specific evaluation.<br>
lookup.setGroovyProject(project)<br>
table.setGroovyProject(project)<br>
def imports = createImportsArray(moduleNode)<br>
<br>
// Build the evaluation context.<br>
def context = new TypeEvaluationContextBuilder()<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .sourceCodeContext(contexts[-1])<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .symbolTable(table)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .memberLookup(lookup)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .classLoader(project.projectClassLoader)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .imports(imports) <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .done()<br>
<br>
// Ready to evaluate.<br>
def eval = new TypeEvaluator(context)<br>
def result = eval.evaluate("node.methods[0].name")<br>
if (result != null &amp;&amp; !result.signature.equals("V")) {<br>
&nbsp;&nbsp;&nbsp; // Do something interesting with the result.<br>
}<br>
</p>

The type evaluator is not guaranteed to return a result. This happens:
<br>
<ul>
	<li>There is an error in the expression, for example a property expression on a void method.</li>
	<li>The type evaluator does not implement logic for some expression. This will become rare as the evaluator
	matures.</li>
</ul>
In addition, the type returned may be set to java.lang.Object in these cases:
<ul>
	<li>When a dynamic method/property is encountered for which an IMemberLookup plugin has not been registered.</li>
	<li>The type evaluator does not know how to infer some variable and gives up returning java.lang.Object.</li>
</ul>
</body>
</html>
